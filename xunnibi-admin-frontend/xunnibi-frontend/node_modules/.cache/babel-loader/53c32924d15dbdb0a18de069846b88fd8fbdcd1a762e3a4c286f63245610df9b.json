{"ast":null,"code":"import axios from \"axios\";\nexport default {\n  data() {\n    return {\n      searchQuery: \"\",\n      // 查询字段\n      tableData: [],\n      // 表格数据\n      dialogVisible: false,\n      // 弹窗显示控制\n      selectedRow: null,\n      // 当前选中的行\n      coinAmount: 0\n    };\n  },\n  mounted() {\n    this.getAllDutyRecords(); // 初次加载获取所有记录\n  },\n  methods: {\n    async getAllDutyRecords() {\n      try {\n        const [DutyListResponse, teamListResponse] = await Promise.all([axios.get(\"http://localhost:8080/dutyrecords/all\"), axios.get(\"http://localhost:8080/team/list\")]);\n        if (DutyListResponse.data.code === 200 && teamListResponse.status === 200) {\n          this.tableData = DutyListResponse.data.data.map(item => {\n            const team = teamListResponse.data.find(t => t.teamId === item.teamId);\n            return {\n              ...item,\n              teamName: team ? team.teamName : \"未知\"\n            };\n          });\n        }\n      } catch (error) {\n        console.error(\"获取待审核列表失败:\", error);\n        this.$message.error(\"获取待审核列表失败，请稍后重试\");\n      }\n    },\n    search() {\n      if (!this.searchQuery) {\n        this.$message.warning(\"请输入团队名称\");\n        return;\n      }\n      this.tableData = this.tableData.filter(item => item.teamName.toLowerCase().includes(this.searchQuery.toLowerCase()));\n    },\n    reset() {\n      this.searchQuery = \"\";\n      this.getAllDutyRecords();\n    },\n    openDialog(row) {\n      this.selectedRow = row;\n      this.dialogVisible = true;\n    },\n    handlePass() {\n      if (!this.selectedRow) return;\n      axios.post(\"http://localhost:8080/dutyrecords/reward\", {\n        dutyId: this.selectedRow.dutyId,\n        teamId: this.selectedRow.teamId,\n        userId: this.selectedRow.userId,\n        coinAwarded: this.coinAmount,\n        status: \"已通过\",\n        dutyDate: this.selectedRow.dutyDate\n      }).then(response => {\n        if (response.data.code === 200) {\n          this.$message.success(\"审核通过成功\");\n          this.dialogVisible = false;\n          this.selectedRow.status = \"已通过\";\n          this.coinAmount = 0;\n        } else {\n          this.$message.error(response.data.msg || \"审核失败\");\n        }\n      }).catch(error => {\n        console.error(error);\n        this.$message.error(\"审核失败\");\n      });\n    },\n    handleNoPass(row) {\n      axios.post(\"http://localhost:8080/dutyrecords/reward\", {\n        dutyId: row.dutyId,\n        teamId: row.teamId,\n        status: \"未通过\",\n        coinAwarded: 0,\n        dutyDate: row.dutyDate\n      }).then(response => {\n        if (response.data.code === 200) {\n          this.$message.success(\"审核不通过成功\");\n          row.status = \"未通过\";\n        } else {\n          this.$message.error(response.data.msg || \"操作失败\");\n        }\n      }).catch(error => {\n        console.error(error);\n        this.$message.error(\"操作失败\");\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","data","searchQuery","tableData","dialogVisible","selectedRow","coinAmount","mounted","getAllDutyRecords","methods","DutyListResponse","teamListResponse","Promise","all","get","code","status","map","item","team","find","t","teamId","teamName","error","console","$message","search","warning","filter","toLowerCase","includes","reset","openDialog","row","handlePass","post","dutyId","userId","coinAwarded","dutyDate","then","response","success","msg","catch","handleNoPass"],"sources":["src/views/manage/DutyReviewView.vue"],"sourcesContent":["<template>\n    <div class=\"container\">\n        <div class=\"header\">\n            <el-input v-model=\"searchQuery\" placeholder=\"请输入团队名称\" style=\"width: 250px\"></el-input>\n            <el-button type=\"info\" plain @click=\"search\">查询</el-button>\n            <el-button type=\"warning\" plain @click=\"reset\">重置</el-button>\n        </div>\n        <div class=\"table-wrapper\">\n            <el-table ref=\"filterTable\" :data=\"tableData\" style=\"width: 100%\" border>\n                <el-table-column prop=\"dutyId\" label=\"值班记录 ID\" align=\"center\" width=\"100px\" />\n                <el-table-column prop=\"teamId\" label=\"团队 ID\" align=\"center\" />\n                <el-table-column prop=\"teamName\" label=\"团队名称\" align=\"center\" />\n                <el-table-column prop=\"dutyDate\" label=\"值班日期\" align=\"center\" />\n                <el-table-column prop=\"coinAwarded\" label=\"奖励虚拟币\" align=\"center\" />\n                <el-table-column prop=\"description\" label=\"描述\" align=\"center\" />\n                <el-table-column prop=\"status\" label=\"状态\" align=\"center\" />\n                <el-table-column prop=\"image\" label=\"图片\" align=\"center\">\n                    <template v-slot=\"scope\">\n                        <img :src=\"scope.row.image\" alt=\"值班图片\" style=\"max-width: 100px; max-height: 100px;\" />\n                    </template>\n                </el-table-column>\n                <el-table-column label=\"操作\" align=\"center\" width=\"300px\">\n                    <template v-slot=\"scope\">\n                        <el-button size=\"mini\" type=\"primary\" plain :disabled=\"scope.row.status === '已通过'\"\n                            @click=\"openDialog(scope.row)\">\n                            审核通过\n                        </el-button>\n                        <el-button size=\"mini\" type=\"danger\" plain @click=\"handleNoPass(scope.row)\"\n                            :disabled=\"scope.row.status === '已通过'\">\n                            审核不通过\n                        </el-button>\n                    </template>\n                </el-table-column>\n            </el-table>\n        </div>\n\n        <el-dialog title=\"增加虚拟币\" :visible.sync=\"dialogVisible\" width=\"400px\">\n            <div>\n                <el-form>\n                    <el-form-item label=\"增加虚拟币数量\">\n                        <el-input-number v-model=\"coinAmount\" :min=\"0\" label=\"虚拟币\" />\n                    </el-form-item>\n                </el-form>\n            </div>\n            <div slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"dialogVisible = false\">取消</el-button>\n                <el-button type=\"primary\" @click=\"handlePass\">确认</el-button>\n            </div>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\nimport axios from \"axios\";\n\nexport default {\n    data() {\n        return {\n            searchQuery: \"\", // 查询字段\n            tableData: [], // 表格数据\n            dialogVisible: false, // 弹窗显示控制\n            selectedRow: null, // 当前选中的行\n            coinAmount: 0\n        };\n    },\n    mounted() {\n        this.getAllDutyRecords(); // 初次加载获取所有记录\n    },\n    methods: {\n        async getAllDutyRecords() {\n            try {\n                const [DutyListResponse, teamListResponse] = await Promise.all([\n                    axios.get(\"http://localhost:8080/dutyrecords/all\"),\n                    axios.get(\"http://localhost:8080/team/list\"),\n                ]);\n                if (DutyListResponse.data.code === 200 && teamListResponse.status === 200) {\n                    this.tableData = DutyListResponse.data.data.map((item) => {\n                        const team = teamListResponse.data.find((t) => t.teamId === item.teamId);\n                        return {\n                            ...item,\n                            teamName: team ? team.teamName : \"未知\",\n                        }\n                    })\n                }\n            } catch (error) {\n                console.error(\"获取待审核列表失败:\", error);\n                this.$message.error(\"获取待审核列表失败，请稍后重试\");\n            }\n        },\n        search() {\n            if (!this.searchQuery) {\n                this.$message.warning(\"请输入团队名称\");\n                return;\n            }\n\n\n            this.tableData = this.tableData.filter(\n                item => item.teamName.toLowerCase().includes(this.searchQuery.toLowerCase())\n            );\n        },\n        reset() {\n            this.searchQuery = \"\";\n            this.getAllDutyRecords();\n        },\n        openDialog(row) {\n            this.selectedRow = row;\n            this.dialogVisible = true;\n        },\n        handlePass() {\n            if (!this.selectedRow) return;\n            axios\n                .post(\"http://localhost:8080/dutyrecords/reward\", {\n                    dutyId: this.selectedRow.dutyId,\n                    teamId: this.selectedRow.teamId,\n                    userId: this.selectedRow.userId,\n                    coinAwarded: this.coinAmount,\n                    status: \"已通过\",\n                    dutyDate: this.selectedRow.dutyDate\n                })\n                .then((response) => {\n                    if (response.data.code === 200) {\n                        this.$message.success(\"审核通过成功\");\n                        this.dialogVisible = false;\n                        this.selectedRow.status = \"已通过\";\n                        this.coinAmount = 0;\n                    } else {\n                        this.$message.error(response.data.msg || \"审核失败\");\n                    }\n                })\n                .catch((error) => {\n                    console.error(error);\n                    this.$message.error(\"审核失败\");\n                });\n        },\n        handleNoPass(row) {\n            axios\n                .post(\"http://localhost:8080/dutyrecords/reward\", {\n                    dutyId: row.dutyId,\n                    teamId: row.teamId,\n                    status: \"未通过\",\n                    coinAwarded: 0,\n                    dutyDate: row.dutyDate\n                })\n                .then((response) => {\n                    if (response.data.code === 200) {\n                        this.$message.success(\"审核不通过成功\");\n                        row.status = \"未通过\";\n                    } else {\n                        this.$message.error(response.data.msg || \"操作失败\");\n                    }\n                })\n                .catch((error) => {\n                    console.error(error);\n                    this.$message.error(\"操作失败\");\n                });\n\n        },\n    },\n};\n</script>\n\n<style scoped>\n.container {\n    padding: 20px;\n    background-color: #f9f9f9;\n}\n\n.header {\n    display: flex;\n    gap: 10px;\n    margin-bottom: 15px;\n}\n\n.header .el-input {\n    max-width: 300px;\n}\n\n.table-wrapper {\n    border: 1px solid #e0e0e0;\n    border-radius: 5px;\n    background-color: #ffffff;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    padding: 10px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}